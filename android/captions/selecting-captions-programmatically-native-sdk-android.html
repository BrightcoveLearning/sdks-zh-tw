---
title: '使用適用於 Android 的本機 SDK 以編程方式選擇字幕' 
description:在本主題中，您將了解如何在使用適用於 Android 的 Brightcove Native SDK 時以編程方式選擇字幕。
parent: Captions 
grandparent: Android Development
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>


<section class="bcls-section">
  <h2 id="Overview">概述</h2>
  <p>
    適用於 Android 的本機 SDK 從以下任一方接收字幕：
  </p>
  <ul>
    <li>Brightcove目錄響應（播放API）：Sidecar WebVTT</li>
    <li>視頻清單（HLS 或 DASH）：清單內WebVTT</li>
  </ul>
  <p>
    有關字幕的更多信息，請參見<a href="https://sdks.support.brightcove.com/features/using-captions-brightcove-native-sdks.html">在Brightcove本機SDK中使用字幕</a>文檔。
  </p>
</section>

<section class="bcls-section">
  <h2 id="Event_sequence">事件順序</h2>
  <p>
    Native SDK 遵循與字幕關聯的以下事件序列：
  </p>
  <ol class="bcls-tasklist">
    <li>
      <p>
        從Brightcove目錄中檢索視頻（即<code translate="No">catalog.findVideoByID()</code>）。
      </p>
    </li>
    <li>
      <p>
        Sidecar 字幕從目錄響應中解析並添加到視頻屬性中。
      </p>
    </li>
    <li>
      <p>
        此時，您可以按以下方式檢索字幕源：
      </p>
      <pre><code class="language-java" translate="No">video.getProperties().get(Video.Fields.CAPTION_SOURCES);</code></pre>
    </li>
    <li>
      <p>
        設置視頻視圖。該視頻已添加到 ExoPlayer。
      </p>
      <pre><code class="language-java" translate="No">brightcoveVideoView.add(video);</code></pre>
    </li>
    <li>
      <p>
        Native SDK 獲取字幕源並發出以下事件：
      </p>
      <pre><code class="language-java" translate="No">EventType.CAPTIONS_LANGUAGES</code></pre>
    </li>
    <li>
      <p>
        將視頻添加到ExoPlayer後，本機SDK會查找清單內字幕。添加了視頻字幕源中尚不存在的所有字幕。如果有新的字幕源，則發送以下事件以更新Brightcove媒體控制器。
      </p>
      <pre><code class="language-java" translate="No">EventType.CAPTIONS_LANGUAGES</code></pre>
    </li>
  </ol>
</section>

<section class="bcls-section">
  <h2 id="Select_captions">選擇字幕</h2>
  <p>
    請按照以下步驟以編程方式選擇字幕：
  </p>
  <ol class="bcls-tasklist__restart">
    <li>
      <p>
        創建一種方法來查找帶有語言代碼的特定字幕源。例如：
      </p>
      <pre><code class="language-java" translate="No">private Pair&lt;Uri, BrightcoveCaptionFormat&gt; getCaptionsForLanguageCode(Video video, String languageCode) {
 Object payload = video == null ? null : video.getProperties().get(Video.Fields.CAPTION_SOURCES);

if (payload instanceof List) {
 @SuppressWarnings(&quot;unchecked&quot;)
 List&lt;Pair&lt;Uri, BrightcoveCaptionFormat&gt;&gt; pairs =
    (List&lt;Pair&lt;Uri, BrightcoveCaptionFormat&gt;&gt;) payload;

 for (Pair&lt;Uri, BrightcoveCaptionFormat&gt; pair : pairs) {
   if (pair.second.language().equals(languageCode)) {
     return pair;
   }
 }
}
return null;
}</code></pre>
    </li>
    <li>
      <p>
        請注意，字幕源位於<code translate="No">Pair&lt;Uri, BrightcoveCaptionFormat&gt;</code>。這<code translate="No">Uri</code>在對中表示隱藏式字幕的類型：
      </p>
      <ul>
        <li>
          <strong>邊車</strong>：存在完整的 URL
        </li>
        <li>
          <strong>艙內</strong>：使用 BrightcoveCaptionFormat.BRIGHTCOVE_SCHEME
        </li>
      </ul>
    </li>
    <li>
      <p>
        通過發出帶有特定語言代碼的視頻，創建一種負責從視頻中選擇隱藏式字幕的方法<code translate="No">EventType.SELECT_CLOSED_CAPTION_TRACK</code>事件。
      </p>
      <pre><code class="language-java" translate="No">private void selectCaption(Video video, String language) {
 Pair&lt;Uri, BrightcoveCaptionFormat&gt; pair = getCaptionsForLanguageCode(video, language);

if (pair != null &amp;&amp; !pair.first.equals(Uri.EMPTY)) {
 // BrightcoveCaptionFormat.BRIGHTCOVE_SCHEME indicates that is not a URL we need to load with the LoadCaptionsService, but instead we'll be enabled through a different component.
 if (!pair.first.toString().startsWith(BrightcoveCaptionFormat.BRIGHTCOVE_SCHEME)) {
   brightcoveVideoView.getClosedCaptioningController().getLoadCaptionsService().loadCaptions(pair.first, pair.second.type());
 }
 Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();
 properties.put(Event.CAPTION_FORMAT, pair.second);
 properties.put(Event.CAPTION_URI, pair.first);
 brightcoveVideoView.getEventEmitter().emit(EventType.SELECT_CLOSED_CAPTION_TRACK, properties);
}
}</code></pre>
    </li>
    <li>
      <p>
        聽<code translate="No">EventType.CAPTIONS_LANGUAGES</code>事件，然後通過語言代碼選擇所需的語言。
      </p>
      <pre><code class="language-java" translate="No">brightcoveVideoView.getEventEmitter().once(EventType.CAPTIONS_LANGUAGES, new EventListener() {
@Override
public void processEvent(Event event) {
 brightcoveVideoView.setClosedCaptioningEnabled(true);

  // You could find the desired languaged in the LANGUAGES list.
  // List&lt;String&gt; languages = event.getProperty(Event.LANGUAGES, List.class);
 selectCaption(brightcoveVideoView.getCurrentVideo(), &quot;ja&quot;);
}
});</code></pre>
    </li>

  </ol>
</section>

</article>