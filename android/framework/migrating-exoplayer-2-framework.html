---
title: '遷移到 ExoPlayer 2 框架' 
description:在本主題中，您將學習如何將 ExoPlayer 2 框架與適用於 Android 的 Brightcove Native Player SDK 結合使用。
parent: Framework 
grandparent: Android Development
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

<section class="bcls-section">
<h2 id="Overview">概述</h2>
<aside class="bcls-aside bcls-aside--information">
<p>使用 ExoPlayer 1 的適用於 Android 的 Brightcove Native SDK 已被棄用。</p>

<p>如果需要，您可以查看<a href="/android/reference/exoplayer1/javadoc/index.html">ExoPlayer 1參考文檔</a>，但建議您遷移到ExoPlayer 2 Framework。</p>
</aside>

<p><a href="https://google.github.io/ExoPlayer/">Google的ExoPlayer</a>是適用於Android的開源，應用程序級媒體播放器。Brightcove利用ExoPlayer來利用其提供的優勢。有關升級到ExoPlayer的好處的更多信息，請參見<a href="https://www.brightcove.com/en/blog/2018/01/brightcove-native-sdk-exoplayer-2">帶有ExoPlayer 2的Brightcove本機SDK</a>博客文章。</p>

<p>了解如何為以下項目類型進行遷移：</p>

<ul>
	<li><a href="#New_project">新項目</a></li>
	<li><a href="#Existing_ExoPlayer_1_project">現有的ExoPlayer 1項目</a></li>
	<li><a href="#Existing_MediaPlayer_project">現有的MediaPlayer項目</a></li>
</ul>

<p>請參閱<a href="https://github.com/BrightcoveOS/android-player-samples">ExoPlayer示例應用程序</a>有關整合<a href="https://medium.com/google-exoplayer/exoplayer-2-x-new-package-and-class-names-ef8e1d9ba96f">ExoPlayer 2</a>框架集成到您的項目中。</p>
</section>

<section class="bcls-section">
<h2 id="New_project">新項目</h2>

<p>請按照以下步驟將ExoPlayer 2添加到新的Android項目中：</p>

<ol class="bcls-tasklist">
	<li>在你的<strong>build.gradle</strong>文件，添加以下依賴項：

	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer2:${anpVersion}"
}</code></pre>
	</li>
	<li>設置<code translate="No">transitive</code>選擇<code translate="No">true</code>告訴 gradle 自動包含其他依賴項，例如離線播放插件。如果您使用的gradle版本小於5，則<a href="https://docs.gradle.org/current/userguide/dependency_management.html">傳遞依賴</a>默認情況下處於關閉狀態。因此，您需要添加以下語句：
	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer2:${anpVersion}" <span class="bcls-highlight">{transitive = true}</span>
}</code></pre>
	</li>
	<li>如果您將環境變量用於SDK版本，請打開<strong>gradle.properties</strong>文件，然後為Android Native SDK設置當前版本值。它看起來應該類似於：
	<pre class="line-numbers">
<code class="language-java" translate="No">anpVersion=6.5.0</code></pre>
	</li>
</ol>
</section>

<section class="bcls-section">
<h2 id="Existing_ExoPlayer_1_project">現有的ExoPlayer 1項目</h2>

<p>請按照以下步驟更新現有的ExoPlayer 1項目以使用ExoPlayer 2框架：</p>

<ol class="bcls-tasklist-restart">
	<li>在你的<strong>constants.gradle</strong>文件，更新Android Build Tools版本：

	<pre class="line-numbers">
<code class="language-java" translate="No">buildToolsVersion "28.0.2"
</code></pre>
	</li>
	<li>在你的<strong>build.gradle</strong>文件，更新Android支持庫：
	<pre class="line-numbers">
<code class="language-java" translate="No">implementation 'com.android.support:appcompat-v7:${APPCOMPAT_V7_VERSION}'
implementation 'com.android.support:support-v4:${SUPPORT_V4_VERSION}'
implementation 'com.android.support:recyclerview-v7:${SUPPORT_V4_VERSION}'
implementation 'com.android.support:support-vector-drawable:${SUPPORT_V4_VERSION}'
</code></pre>

	<p>常數的當前值可以在<a href="https://github.com/BrightcoveOS/android-player-samples/blob/master/constants.gradle">常量.gradle</a>文件。</p>
	</li>
	<li>在你的<strong>build.gradle</strong>文件，添加Google Maven存儲庫：
	<pre class="line-numbers">
<code class="language-java" translate="No">maven {
  url 'https://maven.google.com'
}
</code></pre>
	</li>
	<li>如果您的項目在Google IMA中使用廣告，請更新Google Play服務廣告：
	<pre class="line-numbers">
<code class="language-java" translate="No">implementation 'com.google.android.gms:play-services-ads:'+PLAY_SERVICES_VERSION
</code></pre>

	<aside class="bcls-aside bcls-aside--information">需要注意的是，Brightcove Native Player SDK for Android 不支持嘗試同時使用 ExoPlayer 和 ExoPlayer 2 的應用程序。</aside>
	</li>
	<li>在你的<strong>build.gradle</strong>文件，您之前將Brightcove ExoPlayer庫作為依賴項導入其中，如下所示：
	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer:${anpVersion}"
}
</code></pre>

	<p>更改依賴項的名稱：</p>

	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer2:${anpVersion}"
}
</code></pre>

	<p>Brightcove SDK 版本的當前值 ( <code translate="No">anpVersion</code> ) 可以在<a href="https://github.com/BrightcoveOS/android-player-samples/blob/master/gradle.properties">gradle.properties</a>文件。</p>
	</li>
	<li>設置<code translate="No">transitive</code>選擇<code translate="No">true</code>告訴 gradle 自動包含其他依賴項，例如離線播放插件。如果您使用的gradle版本小於5，則<a href="https://docs.gradle.org/current/userguide/dependency_management.html">傳遞依賴</a>默認情況下處於關閉狀態。因此，您需要添加以下內容：
	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
	implementation "com.brightcove.player:exoplayer2:${anpVersion}" <span class="bcls-highlight">{transitive = true}</span>
}</code></pre>
	</li>
	<li>如果您將環境變量用於SDK版本，請打開<strong>gradle.properties</strong>文件，然後為Android Native SDK設置當前版本值。它看起來應該類似於：
	<pre class="line-numbers">
<code class="language-java" translate="No">anpVersion=6.5.0</code></pre>

	<p>將 ExoPlayer 2 集成到您的項目中應該不需要額外的編碼。</p>
	</li>
</ol>
</section>

<section class="bcls-section">
<h2 id="Existing_MediaPlayer_project">現有的MediaPlayer項目</h2>

<p>請按照以下步驟更新現有的MediaPlayer項目以使用ExoPlayer 2框架：</p>

<ol class="bcls-tasklist-restart">
	<li>在你的<strong>build.gradle</strong>文件，添加以下依賴項：

	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer2:${anpVersion}"
}</code></pre>
	</li>
	<li>設置<code translate="No">transitive</code>選擇<code translate="No">true</code>告訴 gradle 自動包含其他依賴項，例如離線播放插件。如果您使用的gradle版本小於5，則<a href="https://docs.gradle.org/current/userguide/managing_transitive_dependencies.html">傳遞依賴</a>默認情況下處於關閉狀態。因此，您需要添加以下內容：
	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer2:${anpVersion}" <span class="bcls-highlight">{transitive = true}</span>
}</code></pre>
	</li>
	<li>如果您將環境變量用於SDK版本，請打開<strong>gradle.properties</strong>文件，然後為Android Native SDK設置當前版本值。它看起來應該類似於：
	<pre class="line-numbers">
<code class="language-java" translate="No">anpVersion=6.5.0</code></pre>
	</li>
	<li>在您的應用中，使用<a href="/android/reference/javadoc/com/brightcove/player/view/BrightcoveExoPlayerVideoView.html">BrightcoveExoPlayerVideoView</a>而不是<a href="/android/reference/javadoc/com/brightcove/player/view/BrightcoveVideoView.html">BrightcoveVideoView</a>，它使用Android Media Player。</li>
</ol>
</section>

<section class="bcls-section">
<h2 id="Breaking_changes">重大變化</h2>

<p>適用於 Android 的 Brightcove Native SDK 的以下更改是 ExoPlayer 2 的重大更改。Brightcove Native SDK 已棄用 ExoPlayer 1。</p>

<h3>ExoPlayerVideoDisplayComponent內部偵聽器</h3>

<p>這<code translate="No">ExoPlayerVideoDisplayComponent</code>類允許您設置偵聽器以獲取 ExoPlayer 組件的狀態。以下是一些偵聽器的列表：</p>

<table class="bcls-table">
	<thead class="bcls-table__head">
		<tr>
			<th>設置監聽器</th>
			<th>接收有關的狀態信息</th>
		</tr>
	</thead>
	<tbody class="bcls-table__body">
		<tr>
			<td>設置調試監聽器</td>
			<td>信息監聽器</td>
		</tr>
		<tr>
			<td>設置標題監聽器</td>
			<td>CaptionListener</td>
		</tr>
		<tr>
			<td>設置元數據監聽器</td>
			<td>元數據監聽器</td>
		</tr>
		<tr>
			<td>設置內部錯誤監聽器</td>
			<td>InternalErrorListener</td>
		</tr>
	</tbody>
</table>

<p>以下是使用ExoPlayer 2的建議。</p>

<h4>信息監聽器</h4>

<p>為了<code translate="No">InfoListener</code>界面，進行了以下更改：</p>

<ul>
	<li>這<code translate="No">onAvailableRangeChanged</code>方法被刪除</li>
	<li>這<code translate="No">onLoadStarted</code>方法有一個額外的<code translate="No">length</code>範圍</li>
</ul>

<p>例子：使用ExoPlayer 2的ExoPlayerVideoDisplayComponent</p>

<pre class="line-numbers">
<code class="language-java" translate="No">public interface InfoListener {
void onVideoFormatEnabled(Format format, int trigger, long mediaTimeMs);
void onAudioFormatEnabled(Format format, int trigger, long mediaTimeMs);
void onDroppedFrames(int count, long elapsed);
void onBandwidthSample(int elapsedMs, long bytes, long bitrateEstimate);
void onLoadStarted(int sourceId, int type, int trigger, Format format,
				long mediaStartTimeMs, long mediaEndTimeMs);
void onLoadCompleted(int sourceId, long bytesLoaded, int type, int trigger, Format format,
				long mediaStartTimeMs, long mediaEndTimeMs, long elapsedRealtimeMs, long loadDurationMs);
void onDecoderInitialized(String decoderName, long initializedTimestampMs,
				long initializationDurationMs);
}</code></pre>

<h4>CaptionListener</h4>

<p>這<code translate="No">CaptionListener</code>界面不變。</p>

<p>例子：使用ExoPlayer v2的ExoPlayerVideoDisplayComponent</p>

<pre class="line-numbers">
<code class="language-java" translate="No">public interface CaptionListener {
void onCues(List&lt;Cue&gt; cues);
}</code></pre>

<h4>元數據監聽器</h4>

<p>這<code translate="No">MetadataListener</code> ExoPlayer v2 引入了界面。之前使用的<code translate="No">Id3MetadataListener</code>現在已棄用。</p>

<p>例子：使用ExoPlayer v2的ExoPlayerVideoDisplayComponent</p>

<pre class="line-numbers">
<code class="language-java" translate="No">public interface MetadataListener {
void onMetadata(Metadata metadata);
}</code></pre>

<p>隨著新<code translate="No">MetadataListener</code>你會收到一個<code translate="No">Metadadata</code>對像在<code translate="No">onMetadata</code>打回來。隨著棄用<code translate="No">Id3MetadataListener</code>，您收到了一個 Id3Frame 對象列表。使用新的偵聽器，您仍然可以獲得以下列表<code translate="No">Id3Frame</code>對像如下圖：</p>

<pre class="line-numbers">
<code class="language-java" translate="No">exoPlayerVideoDisplayComponent.setMetadataListener(new ExoPlayerVideoDisplayComponent.MetadataListener() {
@Override
public void onMetadata(Metadata metadata) {
 for(int i = 0; i &lt; metadata.length(); i++) {
		 Metadata.Entry entry = metadata.get(i);
		 if (entry instanceof Id3Frame) {
				 Id3Frame id3Frame = (Id3Frame) entry;
		 }
 }
}
});
</code></pre>

<h4>InternalErrorListener</h4>

<p>這<code translate="No">InternalErrorListener</code>界面有很多變化。請檢查以下代碼以進行比較：</p>

<p>使用ExoPlayer v2的ExoPlayerVideoDisplayComponent</p>

<pre class="line-numbers">
<code class="language-java" translate="No">public interface InternalErrorListener {
void onPlayerError(Exception e);
void onAudioTrackUnderrun(int bufferSize, long bufferSizeMs, long elapsedSinceLastFeedMs);
void onLoadError(int sourceId, IOException e);
void onDrmSessionManagerError(Exception e);
}
</code></pre>

<p>使用ExoPlayer v1的ExoPlayerVideoDisplayComponent（<strong>不推薦使用</strong>）</p>

<pre class="line-numbers">
<code class="language-java" translate="No">public interface InternalErrorListener {
void onRendererInitializationError(Exception e);
void onAudioTrackInitializationError(AudioTrack.InitializationException e);
void onAudioTrackWriteError(AudioTrack.WriteException e);
void onAudioTrackUnderrun(int bufferSize, long bufferSizeMs, long elapsedSinceLastFeedMs);
void onDecoderInitializationError(MediaCodecTrackRenderer.DecoderInitializationException e);
void onCryptoError(MediaCodec.CryptoException e);
void onLoadError(int sourceId, IOException e);
void onDrmSessionManagerError(Exception e);
}
</code></pre>

<p>使用 ExoPlayer 2 時，您遇到的異常類型<code translate="No">onPlayerError(Exception e)</code>是<code translate="No">com.google.android.exoplayer2.ExoPlaybackException</code>，但這在未來可能會改變。</p>

<p>通過使用com.google.android.exoplayer2.ExoPlaybackException，您可以獲取以下異常類型：</p>

<ul>
	<li><code translate="No">ExoPlaybackException.TYPE_SOURCE</code></li>
	<li><code translate="No">ExoPlaybackException.TYPE_RENDERER</code></li>
	<li><code translate="No">ExoPlaybackException.TYPE_UNEXPECTED</code></li>
</ul>

<p>您還可以通過獲取錯誤的原因來檢索<code translate="No">Throwable</code>對象與<code translate="No">ExoPlaybackException.getSourceException()</code> .</p>

<h3>離線播放支持</h3>

<p>如果您的項目正在使用<code translate="No">MediaDownloadable.setConfigurationBundle(Bundle)</code>指定下載首選項（例如視頻比特率）的方法，然後請按以下方式更新代碼：</p>

<p>舊格式（不建議使用）</p>

<pre class="line-numbers">
<code class="language-java" translate="No">com.google.android.exoplayer.MediaFormat
</code></pre>

<p>新格式</p>

<pre class="line-numbers">
<code class="language-java" translate="No">com.brightcove.player.model.MediaFormat
</code></pre>

<h3>舊版媒體API類</h3>

<p>已棄用的舊版 Media API 類，在<code translate="No">com.brightcove.player.media package</code>，已從適用於 Android 的 Brightcove Native SDK 中刪除。</p>

<p>如果您使用的是Media類，則需要遷移並開始使用<code translate="No">com.brightcove.player.edge.Catalog</code>班級。</p>

<p>以下課程已從<code translate="No">com.brightcove.player.media</code>到<code translate="No">com.brightcove.player.model</code>：</p>

<ul>
	<li><code translate="No">DeliveryType.java</code></li>
	<li><code translate="No">CaptionType.java</code></li>
	<li><code translate="No">ErrorFields.java</code></li>
	<li><code translate="No">VideoFields.java</code></li>
</ul>

<aside class="bcls-aside bcls-aside--tip">如果你正在使用這四個類中的任何一個，你只需要替換導入包就可以了。</aside>
</section>

<section class="bcls-section">
<h2 id="Additional_Resources">其他資源</h2>

<p>有關使用ExoPlayer 2框架的更多信息，請參見以下文檔：</p>

<ul>
	<li><a href="https://medium.com/google-exoplayer/exoplayer-2-x-new-package-and-class-names-ef8e1d9ba96f">ExoPlayer 2-新程序包和類名稱</a></li>
	<li><a href="https://google.github.io/ExoPlayer/guide.html">ExoPlayer開發人員指南</a></li>
</ul>
</section>
</article>