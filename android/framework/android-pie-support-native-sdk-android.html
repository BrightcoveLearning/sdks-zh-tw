---
title: '帶有適用於 Android 的本機 SDK 的 Android Pie 支持' 
description:在本主題中，您將了解如何將 Android Pie 與適用於 Android 的 Brightcove Native SDK 結合使用。
parent: Framework 
grandparent: Android Development
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

<section class="bcls-section">
<h2 id="Overview">概述</h2>

<p>Android Pie是最新的Android操作系統，已於2018年8月6日正式發布。有關功能的詳細信息，請參見<a href="https://developer.android.com/about/versions/pie/android-9.0">Android Pie功能</a>文檔。Android Pie包含一些行為更改。它們中的大多數會影響以Android Pie（API級別28）為目標的應用程序，但是您可能還會發現以Android Pie設備運行的較舊Android版本的應用程序存在問題。</p>

<figure class="bcls-figure"><img class="bcls-image--no-border" alt="Android 9 Pie" src="/assets/images/android/framework/android-pie.png" />
<figcaption class="bcls-caption--image">Android 9派</figcaption>
</figure>

<p>使用適用於 Android 的 Brightcove SDK 時需要注意一些更改：</p>

<ul>
	<li><a href="">默認啟用 TLS</a></li>
	<li><a href="">Apache HTTP客戶端棄用</a></li>
	<li><a href="">不建議使用的常數</a></li>
</ul>

<p>有關您的應用行為更改的完整列表，請參見<a href="https://developer.android.com/about/versions/pie/android-9.0-changes-all">所有應用程序的行為更改</a>文檔。有關在定位Android Pie時專有的行為更改，請參見<a href="https://developer.android.com/about/versions/pie/android-9.0-changes-28">API 28+的行為更改</a>文檔。</p>
</section>

<section class="bcls-section">
<h2 id="TLS_enabled_by_default">默認啟用 TLS</h2>

<p>傳輸層安全 (TLS) 是一種用於通過計算機網絡提供安全通信的協議。TLS 是在 HTTP 之上實現的，允許通過 HTTPS 進行加密通信。</p>

<p>當 Google 發布 Android Marshmallow（API 級別 23）時，它提供了禁用明文流量的配置，這將阻止您的應用發出明確的 HTTP 請求。隨著 Android Pie（API 級別 28）的發布，默認情況下禁用明文流量。</p>

<p>默認情況下禁用明文流量，如果您的應用程序嘗試執行明文 HTTP 請求，則會拋出 IOException 並顯示以下消息：</p>

<pre>
<code class="language-java" translate="No">Exception: IOException java.io.IOException: Cleartext HTTP traffic to * not permitted</code></pre>

<p>有關更多信息，請訪問Google的網站：<a href="https://developer.android.com/about/versions/pie/android-9.0-changes-28#framework-security-changes">框架安全性變更</a>和<a href="https://developer.android.com/training/articles/security-config">網絡安全配置</a>。</p>

<p>如果您的應用定位到Android Pie（API級別28）或更高版本，則需要處理此行為更改，以使您的應用按預期運行。您有三個選擇：</p>

<ul>
	<li><a href="#HTTPS_only">確保您的應用僅發出HTTPS請求</a></li>
	<li><a href="#HTTP_for_all_domains">為所有域啟用清晰的HTTP流量</a></li>
	<li><a href="#HTTP_for_specific_domains">為特定域啟用清晰的HTTP流量</a></li>
</ul>
<!-- <p>With the release of Android Pie (API level 28), clear text traffic is disabled by default. If your application attempts to do a clear HTTP request, an <code translate="No">IOException</code> will be thrown with the message:</p>
  <pre><code class="language-java" translate="No">Exception: IOException java.io.IOException: Cleartext HTTP traffic to * not permitted</code></pre>
  <p>
    To learn more about managing TLS with Android Pie, see the following document:
https://docs.google.com/document/d/1PfXOq59MG8s87gcwiZvzWCZ_CuKDpLi3VO-VRF_LkjY/edit?usp=sharing
  </p> -->

<h3 id="HTTPS_only">僅HTTPS</h3>

<p>一種選擇是確保所有網絡請求都使用HTTPS。為此，請按照下列步驟操作：</p>

<ol class="bcls-tasklist__restart">
	<li>
	<p>啟用CDN以進行安全通信。</p>

	<ul>
		<li>Video Cloud 客戶（無論您使用的是內部 CDN 還是指定的 CDN）應聯繫他們的 Brightcove 客戶經理，以確保將帳戶配置為通過 HTTPS 進行交付。</li>
		<li>
			<p>
				對於使用遠程資產的用戶，您可能需要適當地配置CDN。
			</p>
		<aside class="bcls-aside bcls-aside--information">如果您使用的是 BYO CDN，則需要通過正確的<code translate="No">X-Forwarded-Proto: https</code>標題。對於 Akamai 或 Cloudfront，您可以使用<code translate="No">X-Forwarded-Proto-Akamai</code>或者<code translate="No">CloudFront-Forwarded-Proto</code>分別。</aside></li>
	</ul>
	</li>
	<li>
	<p>使用安全通信來傳遞您的媒體內容。這包括視頻、廣告、標題、海報圖像、縮略圖和其他第三方 API 連接。</p>

	<ul>
		<li>
		<p>視頻雲客戶：使用 Playback API 檢索每個資產的安全協議。適用於 Android 的 Brightcove SDK 在可用時默認選擇 HTTPS。</p>

		<aside class="bcls-aside bcls-aside--information">如果您的視頻同時具有用於 WebVTT 字幕/副標題的 HTTP 和 HTTPS 源，則適用於 Android 的本機 SDK 可能不會返回 HTTPS 版本。Brightcove 已意識到這種情況，並將在未來版本中進行修復。</aside>
		</li>
		<li>Brightcove Player客戶：確保您的媒體內容通過HTTPS傳遞。</li>
	</ul>
	</li>
</ol>

<h3 id="HTTP_for_all_domains">適用於所有域的HTTP</h3>

<p>您的應用可以為所有域使用清晰的 HTTP 流量。以下是有關如何執行此操作的兩個示例：</p>

<ul>
	<li><a href="#Update_the_application_tag">更新應用程序標籤</a></li>
	<li><a href="#Add_a_network_security_configuration_file">添加網絡安全配置文件</a></li>
</ul>

<h4 id="Update_the_application_tag">更新應用程序標籤</h4>

<ol class="bcls-tasklist__restart">
	<li>
	<p>要啟用此功能，請打開<strong>安卓清單</strong>文件，並在其中添加以下行<code translate="No">application</code>標籤。例如：</p>

	<pre>
<code class="language-java" translate="No">&lt;application
   android:name="mypackage.MyApplication"
   <span class="bcls-highlight">android:usesCleartextTraffic="true"&gt;</span>
…
&lt;/application&gt;</code></pre>
	</li>
</ol>

<h4 id="Add_a_network_security_configuration_file">添加網絡安全配置文件</h4>

<ol class="bcls-tasklist__restart">
	<li>
	<p>創建一個xml文件，例如<strong>網絡安全配置文件</strong>，並將其添加到<strong>資源/ xml</strong>目錄。有關如何允許暢通流量的信息，請參見以下示例：</p>

	<pre>
<code class="language-java" translate="No">&lt;network-security-config&gt;
   &lt;base-config cleartextTrafficPermitted="true"/&gt;
&lt;/network-security-config&gt;</code></pre>
	</li>
	<li>
	<p>在你的文件中設置文件名<strong>安卓清單</strong>如下所示：</p>

	<pre>
<code class="language-java" translate="No">&lt;application
 android:name="mypackage.MyApplication"
 <span class="bcls-highlight">android:networkSecurityConfig="@xml/network_security_config"&gt;</span>
…
&lt;/application&gt;</code></pre>

	<p>有關更多詳細信息，請參見Android的<a href="https://developer.android.com/training/articles/security-config">網絡安全配置</a>文檔。</p>
	</li>
</ol>

<h3 id="HTTP_for_specific_domains">特定域的HTTP</h3>

<p>您可以指定允許使用明文 HTTP 請求的某些域。為此，請按照下列步驟操作：</p>

<ol class="bcls-tasklist__restart">
	<li>
	<p>創建一個xml文件，例如<strong>網絡安全配置文件</strong>，並將其添加到<strong>資源/ xml</strong>目錄。有關如何設置域的信息，請參閱以下示例：</p>

	<pre>
<code class="language-java" translate="No">&lt;network-security-config&gt;
 &lt;domain-config cleartextTrafficPermitted="true"&gt;
     &lt;domain includeSubdomains="true"&gt;c.brightcove.com&lt;/domain&gt;
     &lt;domain includeSubdomains="true"&gt;solutions.brightcove.com&lt;/domain&gt;
 &lt;/domain-config&gt;
&lt;/network-security-config&gt;</code></pre>
	</li>
	<li>
	<p>在你的文件中設置文件名<strong>安卓清單</strong>如下所示：</p>

	<pre>
<code class="language-java" translate="No">&lt;application
 android:name="mypackage.MyApplication"
 <span class="bcls-highlight">android:networkSecurityConfig="@xml/network_security_config"&gt;</span>
…
&lt;/application&gt;</code></pre>

	<p>有關更多詳細信息，請參見Android的<a href="https://developer.android.com/training/articles/security-config">網絡安全配置</a>文檔。</p>

	<aside class="bcls-aside bcls-aside--information">這<code translate="No">networkSecurityConfig</code>參數覆蓋<code translate="No">usesCleartextTraffic</code>範圍。這意味著如果兩者都啟用，則只有在<code translate="No">networkSecurityConfig</code> file 參數將被允許使用明確的 HTTP 請求。</aside>
	</li>
</ol>
</section>

<section class="bcls-section">
<h2 id="Apache_HTTP_client_deprecation">Apache HTTP客戶端棄用</h2>

<p>在 Android Pie 中，Apache HTTP 客戶端支持已被刪除。這會影響面向 Android Pie 或更高版本的應用。當使用非標準版本時，它也可能會影響以舊版Android為目標的應用<code translate="No">ClassLoader</code>。在運行時，如果<code translate="No">ClassLoader</code>嘗試在Android Pie上加載Apache HTTP客戶端類，它將拋出<code translate="No">NoClassDefFoundError</code>。有關更多信息，請參見Google的：<a href="https://developer.android.com/about/versions/pie/android-9.0-changes-all#apache-nonp">Apache HTTP客戶端棄用</a>文檔。</p>

<p>如果您的應用程序使用的是Brightcove FreeWheel插件，您將遇到此問題並得到如下所示的異常：</p>

<pre>
<code class="language-java" translate="No">java.lang.NoClassDefFoundError: tv.freewheel.utils.URLLoader
Caused by: java.lang.NoClassDefFoundError: Failed resolution of: Lorg/apache/http/impl/client/BasicCookieStore;</code></pre>

<p>為了解決此問題，請將以下行添加到應用的清單文件中：</p>

<pre>
<code class="language-java" translate="No">&lt;uses-library android:name="org.apache.http.legacy" android:required="false"/&gt;</code></pre>
</section>

<section class="bcls-section">
<h2 id="Deprecated_constants">不建議使用的常數</h2>

<p>有幾個常量在<a href="https://developer.android.com/reference/android/net/ConnectivityManager">連接管理器</a>班級。其中一些常量目前由 Brightcove SDK 使用，特別是離線播放和離線分析功能。這是清單：</p>

<ul>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_BLUETOOTH</code></li>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_ETHERNET</code></li>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_MOBILE</code></li>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_VPN</code></li>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_WIFI</code></li>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_WIMAX</code></li>
</ul>

<p>這不會影響上述功能的任何功能，但請注意，這些常量可能會在未來的 Android 操作系統版本中刪除。這也適用於 Brightcove Native SDK。</p>
</section>
<!-- <section class="bcls-section">
<h2 id="Testing_limitations">Testing limitations</h2>

<p>Due to resource constraints, we have been unable to test the Brightcove SDK targeting Android Pie on a device that has a "cut-out" in its display. We are working on acquiring such a device to test with as soon as possible.</p>
</section> --></article>