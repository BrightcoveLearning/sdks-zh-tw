---
title: '同步 WebVTT 字幕' 
description:在本主題中，您將學習如何為 HLS 視頻配置 WebVTT 字幕以將音頻和視頻與字幕同步。
parent: Features 
grandparent: Home
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

<section class="bcls-section">
<h2 id="Overview">概述</h2>

<p>Web Video Text Tracks (WebVTT) 文件是一個簡單的文本文件，用於將字幕、副標題、描述等與視頻中的時間段相關聯。</p>

<pre class="line-numbers">
<code class="language-html" translate="No">WEBVTT

  00:00:03.50 --&gt; 00:00:05.000 align:middle line:84%
  In this video, you'll learn
  about how Video Cloud Studio is</code></pre>

<p>有關添加WebVTT文件的詳細信息，請參見<a href="https://player.support.brightcove.com/general/adding-captions-videos-programmatically.html">為視頻添加字幕</a>文檔。</p>

<!-- <p>The <a href="https://github.com/brightcove/brightcove-player-sdk-ios-sidecarsubtitles">Sidecar Subtitles plugin</a> enables you to use WebVTT captions in your iOS and tvOS apps.</p> -->
</section>

<section class="bcls-section">
<h2 id="Add_a_metadata_header">添加元數據標頭</h2>

<p>作為HLS規範的一部分，您需要添加一個<code translate="No">X-TIMESTAMP-MAP</code>每個WebVTT標頭的元數據標頭，以使音頻和視頻與字幕之間的時間戳同步。</p>

<p>如果您缺少此標題或<code translate="No">MPEGTS</code>值不正確，您可能會看到字幕與視頻不同步。這是因為當<code translate="No">X-TIMESTAMP-MAP</code>標頭丟失，客戶端假定默認時間戳偏移量為<strong>0</strong> .例如，使用值之間的差異<strong>900000</strong>和<strong>0</strong>可能會使字幕關閉10秒。</p>

<p><code translate="No">X-TIMESTAMP-MAP</code>格式：</p>

<pre class="line-numbers">
<code class="language-swift" translate="No">X-TIMESTAMP-MAP=MPEGTS:&lt;MPEG-2 time&gt;,LOCAL:&lt;cue time&gt;</code></pre>
<!-- <p><code data-gist-id="d59006640cce4709fdc2" data-gist-line="2" data-gist-hide-footer="true"></code></p> -->

<p>這是一個示例WebVTT文件：</p>

<aside class="bcls-aside bcls-aside--information">這<code translate="No">X-TIMESTAMP-MAP</code>標題必須出現在第 2 行，緊跟在<code translate="No">WEBVTT</code>線。如果時間戳標頭未放在第 2 行，您可能會遇到意外結果。</aside>

<pre class="line-numbers">
<code class="language-swift" translate="No">WEBVTT
<span class="bcls-highlight">X-TIMESTAMP-MAP=MPEGTS:900000,LOCAL:00:00:00.000</span>

1
00:00:03.500 --&gt; 00:00:05.000 align:middle line:84%
In this video, you'll learn
about how Video Cloud Studio is</code></pre>
<!-- <p><code data-gist-id="d59006640cce4709fdc2" data-gist-line="5-11" data-gist-highlight-line="6" data-gist-hide-footer="true"></code></p> -->

<p>有關詳細信息，請參見<a href="https://tools.ietf.org/html/draft-pantos-http-live-streaming-18#section-3">字幕段</a> Apple的HLS協議文檔中的“內容"部分。</p>
</section>

<section class="bcls-section">
<h2 id="Determine_the_offset_value">確定偏移值</h2>

<p>如果您正在使用Brightcove的Dynamic Ingest或Zencoder對您的內容進行轉碼，請使用偏移值<code translate="No">MPEGTS:900000</code>。</p>

<p>如果您使用的不是Zencoder編碼系統，則最好獲取所需的值。Apple建議您設置偏移量以匹配您的編碼視頻。</p>

<p>這<code translate="No">MPEGTS</code>值對應於給定的 MPEG 幀的呈現時間戳 (PTS) 值<code translate="No">LOCAL</code>時間。如果您使用的是Brightcove的舊版提取系統，則可能會發現您可以使用的值為<code translate="No">MPEGTS:0</code>。</p>

<p>如果您的帳戶已啟用<a href="https://studio.support.brightcove.com/general/overview-dynamic-delivery.html">動態交付</a>，並且您正在與我們一起託管字幕 <em>（非遠程字幕）</em>，然後我們將使一切自動神奇地工作（PTS 需要為零，我們將確保它為零。）</p>

<p>如果您的帳戶啟用了 Dynamic Delivery 並且您正在使用<strong><em>偏僻的</em></strong>字幕，您需要將 PTS 值設置為零。</p>

<p>例如，要獲取偏移值，您可以執行以下操作：</p>

<h3>請求1：</h3>

<p>在終端中，獲取HLS視頻並將其存儲在本地文件中。在這種情況下，我們將其命名<code translate="No">seg.ts</code>。</p>

<pre class="line-numbers">
<code class="language-http" translate="No">curl -o seg.ts "http://brightcove.vo.llnwd.net/v1/unsecured/media/4360108595001/201507/1154/4360341622001/4360108595001_4360341622001_s-1.ts?pubId=4360108595001&amp;videoId=4360283683001"</code></pre>
<!-- <p><code data-gist-id="d59006640cce4709fdc2" data-gist-line="17-18"></code></p> -->

<h3>要求2：</h3>

<p>然後，使用<code translate="No">ffprobe</code>命令獲取偏移值。<code translate="No">ffprobe</code>是一個多媒體流分析器，它是<a href="//ffmpeg.org/about.html">FFmpeg 框架</a> .您需要在您的計算機上下載並安裝它。</p>

<pre class="line-numbers">
<code class="language-http" translate="No">ffprobe -show_frames seg.ts</code></pre>

<h3>回复：</h3>

<p>您的回复應該類似於：</p>

<pre class="line-numbers">
<code class="language-html" translate="No"><span class="bcls-highlight">pkt_pts=900000</span>
pkt_pts_time=10.000000
pkt_dts=900000
pkt_dts_time=10.000000</code></pre>
<!-- <p><code data-gist-id="d59006640cce4709fdc2" data-gist-line="21-24" data-gist-highlight-line="21" data-gist-hide-footer="true"></code></p> -->

<br/>
<aside class="bcls-aside bcls-aside--warning">添加 X-TIMESTAMP-MAP 標頭可能會導致其他平台（例如 Windows Mobile 應用程序）上的不一致。添加offset標頭後，請確保在所有平台上進行測試。添加此標頭標記是 HLS 規範要求，而不是 WebVTT 規範參數。</aside>
</section>

<section class="bcls-section">
<h2 id="Best_practices">最佳實務</h2>

<p>在開髮帶有字幕的應用程序時，以下指南應該會有所幫助。</p>

<h3>字幕時長</h3>

<p>建議字幕時長不要超過視頻時長。這將防止在視頻播放完成後顯示字幕或在進度條中出現不可搜索的區域。</p>
</section>
</article>